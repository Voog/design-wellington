!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";var t,o,r;o=function(){function t(t){this.comparator=t,this.contents=[],this.sorted=!1}return t.prototype.sort=function(){return this.contents.sort(this.comparator),this.sotred=!0},t.prototype.push=function(t){return this.contents.push(t),this.sorted=!1},t.prototype.peek=function(t){return null==t&&(t=this.contents.length-1),this.sorted||this.sort(),this.contents[t]},t.prototype.pop=function(){return this.sorted||this.sort(),this.contents.pop()},t.prototype.size=function(){return this.contents.length},t.prototype.map=function(t){return this.contents.map(t)},t}(),t=function(){var t,r,n,e,i,s;function u(){this.maxIterations=1e3,this.fractByPopulations=.75}return u.sigbits=5,u.rshift=8-u.sigbits,e=function(t,o,r){return(t<<2*u.sigbits)+(o<<u.sigbits)+r},t=function(){function t(t,o,r,n,e,i,s){this.r1=t,this.r2=o,this.g1=r,this.g2=n,this.b1=e,this.b2=i,this.histo=s}return t.prototype.volume=function(t){return this._volume&&!t||(this._volume=(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)),this._volume},t.prototype.count=function(t){var o,r,n,i,s,u,c,h,f,a,p;if(!this._count_set||t){for(i=0,s=u=this.r1,f=this.r2;u<=f;s=u+=1)for(r=c=this.g1,a=this.g2;c<=a;r=c+=1)for(o=h=this.b1,p=this.b2;h<=p;o=h+=1)n=e(s,r,o),i+=this.histo[n]||0;this._count_set=!0,this._count=i}return this._count},t.prototype.copy=function(){return new t(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histo)},t.prototype.average=function(t){var o,r,n,i,s,c,h,f,a,p,g,l,b,v,d,x;if(!this._average||t){for(h=1<<8-u.sigbits,p=0,a=0,i=0,r=0,f=g=this.r1,v=this.r2;g<=v;f=g+=1)for(n=l=this.g1,d=this.g2;l<=d;n=l+=1)for(o=b=this.b1,x=this.b2;b<=x;o=b+=1)c=e(f,n,o),p+=s=this.histo[c]||0,a+=s*(f+.5)*h,i+=s*(n+.5)*h,r+=s*(o+.5)*h;this._average=p?[~~(a/p),~~(i/p),~~(r/p)]:[~~(h*(this.r1+this.r2+1)/2),~~(h*(this.g1+this.g2+1)/2),~~(h*(this.b1+this.b2+1)/2)]}return this._average},t.prototype.contains=function(t){var o,r,n;return n=t[0]>>u.rshift,r=t[1]>>u.rshift,o=t[2]>>u.rshift,this.r1<=n&&n<=this.r2&&this.g1<=r&&r<=this.g2&&this.b1<=o&&o<=this.b2},t}(),r=function(){function t(){this.cboxes=new o((function(t,o){var r,n;return(r=t.count()*t.volume())>(n=o.count()*o.volume())?1:r<n?-1:0}))}return t.prototype.push=function(t){return this.cboxes.push({cbox:t,color:t.average()})},t.prototype.palette=function(){return this.cboxes.map((function(t){return t.color}))},t.prototype.size=function(){return this.cboxes.size()},t.prototype.map=function(t){var o,r,n;for(o=r=0,n=this.cboxes.size();r<n;o=r+=1)return this.cboxes.peek(o).cbox.contains(t)?this.cboxes.peek(o).color:this.nearest(t)},t.prototype.cboxes=function(){return this.cboxes},t.prototype.nearest=function(t){var o,r,n,e,i,s,u;for(i=function(t){return t*t},n=1e9,r=s=0,u=this.cboxes.size();s<u;r=s+=1)(o=Math.sqrt(i(t[0]-this.cboxes.peek(r).color[0])+i(t[1]-this.cboxes.peek(r).color[1])+i(t[2]-this.cboxes.peek(r).color[2])))<n&&(n=o,e=this.cboxes.peek(r).color);return e},t}(),i=function(t){var o,r,n,i,s,c,h,f,a;for(i=1<<3*u.sigbits,n=new Array(i),f=0,a=t.length;f<a;f++)h=(c=t[f])[0]>>u.rshift,r=c[1]>>u.rshift,o=c[2]>>u.rshift,n[s=e(h,r,o)]=(n[s]||0)+1;return n},n=function(o,r){var n,e,i,s,c,h,f,a,p,g,l,b;for(g=1e6,p=0,h=1e6,c=0,i=1e6,e=0,l=0,b=o.length;l<b;l++)(a=(f=o[l])[0]>>u.rshift)<g?g=a:a>p&&(p=a),(s=f[1]>>u.rshift)<h?h=s:s>c&&(c=s),(n=f[2]>>u.rshift)<i?i=n:n>e&&(e=n);return new t(g,p,h,c,i,e,r)},s=function(t,o){var r,n,i,s,u,c,h,f,a,p,g,l,b,v,d,x,m,y,w,_,C,k,z,M,j,I,D,q,S,B;if(o.count()){if(1===o.count())return[o.copy()];if(p=o.r2-o.r1+1,u=o.g2-o.g1+1,n=o.b2-o.b1+1,h=Math.max(p,u,n),l=0,f=[],c=[],h===p)for(a=b=o.r1,k=o.r2;b<=k;a=b+=1){for(g=0,s=v=o.g1,D=o.g2;v<=D;s=v+=1)for(r=d=o.b1,q=o.b2;d<=q;r=d+=1)g+=t[e(a,s,r)]||0;l+=g,f[a]=l}else if(h===u)for(s=x=o.g1,S=o.g2;x<=S;s=x+=1){for(g=0,a=m=o.r1,B=o.r2;m<=B;a=m+=1)for(r=y=o.b1,z=o.b2;y<=z;r=y+=1)g+=t[e(a,s,r)]||0;l+=g,f[s]=l}else for(r=w=o.b1,M=o.b2;w<=M;r=w+=1){for(g=0,a=_=o.r1,j=o.r2;_<=j;a=_+=1)for(s=C=o.g1,I=o.g2;C<=I;s=C+=1)g+=t[e(a,s,r)]||0;l+=g,f[r]=l}return f.forEach((function(t,o){return c[o]=l-t})),i=function(t){var r,n,e,i,s,u,h,a,p,g,b;for(u=t+"2",h=g=o[s=t+"1"],b=o[u];g<=b;h=g+=1)if(f[h]>l/2){for(r=o.copy(),n=o.copy(),i=(a=h-o[s])<=(p=o[u]-h)?Math.min(o[u]-1,~~(h+p/2)):Math.max(o[s],~~(h-1-a/2));!f[i];)i++;for(e=c[i];!e&&f[i-1];)e=c[--i];return r[u]=i,n[s]=r[u]+1,[r,n]}},h===p?i("r"):h===u?i("g"):h===n?i("b"):void 0}},u.prototype.quantize=function(t,e){var u,c,h,f,a,p,g=this;if(!t.length||e<2||e>256)return console.log("invalid arguments"),!1;for(h=i(t),u=n(t,h),(a=new o((function(t,o){var r,n;return(r=t.count())>(n=o.count())?1:r<n?-1:0}))).push(u),(f=function(t,o){var r,n,e,i,c;for(i=1,c=0;c<g.maxIterations;)if((u=t.pop()).count()){if(r=(e=s(h,u))[0],n=e[1],!r)return void console.log("cbox1 not defined; shouldn't happen");if(t.push(r),n&&(t.push(n),i++),i>=o)return;if(c++>g.maxIterations)return void console.log("infinite loop; perhaps too few pixels")}else t.push(u),c++})(a,this.fractByPopulations*e),p=new o((function(t,o){var r,n;return(r=t.count()*t.volume())>(n=o.count()*o.volume())?1:r<n?-1:0}));a.size();)p.push(a.pop());for(f(p,e-p.size()),c=new r;p.size();)c.push(p.pop());return c},u}.call(void 0),function(){window.ColorExtract=function(){function o(){}return o.getColorMap=function(o,r,n,e,i,s){var u,c,h,f,a,p,g,l,b,v;for(null==s&&(s=8),h=o.getContext("2d").getImageData(r,n,e,i).data,f=[],p=g=n,b=n+i;g<b;p=g+=1)for(c=p*e*4,a=l=r,v=r+e;l<v;a=l+=1)u=c+4*a,f.push([h[u],h[u+1],h[u+2]]);return(new t).quantize(f,s)},o.colorDist=function(t,o){var r;return(r=function(t){return t*t})(t[0]-o[0])+r(t[1]-o[1])+r(t[2]-o[2])},o.extract=function(t,r,n){var e,i,s,u,c,h,f,a,p,g,l,b,v;for(r.width=25,r.height=25,r.getContext("2d").drawImage(t,0,0,r.width,r.height),(i=o.getColorMap(r,0,0,r.width,r.height,4).cboxes.map((function(t){return{count:t.cbox.count(),rgb:t.color}}))).sort((function(t,o){return o.count-t.count})),e=i[0].rgb,(f=o.getColorMap(r,0,0,t.width,t.height,10).cboxes.map((function(t){return{count:t.cbox.count(),rgb:t.color}}))).sort((function(t,o){return o.count-t.count})),a=0,g=0,b=f.length;g<b;g++)s=f[g],(u=o.colorDist(e,s.rgb))>a&&(a=u,c=s.rgb);for(a=0,l=0,v=f.length;l<v;l++)s=f[l],(u=o.colorDist(e,s.rgb))>a&&s.rgb!==c&&(a=u,h=s.rgb);return p=function(t){return"rgb("+t[0]+", "+t[1]+", "+t[2]+")"},n({bgColor:p(e),fgColor:p(c),fgColor2:p(h)})},o}()}.call(void 0),r=jQuery,window.site=r.extend(window.site||{},{bindSiteSearch:(t,o,n)=>{t&&new VoogSearch(t,{per_page:10,lang:o,resultsContainer:r(".js-voog-search-modal-inner").get(0),sideclick:!0,mobileModeWidth:480,updateOnKeypress:!0,noResults:n})}}),r(".container").on("mousedown",(function(t){r(t.target).closest(".js-prevent-sideclick").length||(r(".js-popover").removeClass("expanded"),r(".js-search-close-btn").trigger("click"),r(".js-image-settings-popover").toggleClass("active"))}))}));
