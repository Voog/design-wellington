!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e,t,a,i,o;e=jQuery,t=function(t,a){a>=.5?e(t).find("> .js-background-type").addClass("light-background").removeClass("dark-background"):e(t).find("> .js-background-type").addClass("dark-background").removeClass("light-background")},a=function(t,a){var i=function(t,a){if(t&&a){"string"==typeof t&&(t=t.replace(/rgba?\(/,"").replace(/\)/,"").split(","),e.each(t,(function(e,a){t[e]=+a}))),"string"==typeof a&&(a=a.replace(/rgba?\(/,"").replace(/\)/,"").split(","),e.each(a,(function(e,t){a[e]=+t}))),"object"==typeof t&&t.hasOwnProperty("length")&&3==t.length&&t.push(1),"object"==typeof a&&a.hasOwnProperty("length")&&3==a.length&&a.push(1);var i=[0,0,0,0];return i[3]=1-(1-a[3])*(1-t[3]),0===i[3]&&(i[3]=1e-6),i[0]=Math.min(a[0]*a[3]/i[3]+t[0]*t[3]*(1-a[3])/i[3],255),i[1]=Math.min(a[1]*a[3]/i[3]+t[1]*t[3]*(1-a[3])/i[3],255),i[2]=Math.min(a[2]*a[3]/i[3]+t[2]*t[3]*(1-a[3])/i[3],255),e.map(i,(function(e){return Math.floor(e)}))}}(t||[255,255,255,1],a||[255,255,255,1]);return i},i=function(e,t){var i=a(e,t);return Math.round((.2126*+i[0]+.7152*+i[1]+.0722*+i[2])/2.55)/100},o=function(e,t){e.find(".image_settings").show(),e.removeClass("without-image is-loaded with-error").addClass("with-image not-loaded"),t.removeClass("is-hidden").addClass("is-visible")},window.site=e.extend(window.site||{},{bgPickerPreview:function(a,o,s){var n=e(a).css("background-image"),r=o.imageSizes?function(e,t){for(var a,i=0,o=e.length;i<o;i++){if(e[i].width<t)return a||e[i];a=e[i]}return e[e.length-1]}(o.imageSizes,e(window).width()):null,d=o.image&&""!==o.image?"url("+r.url+")":"none",c=o.imageSizes&&""!==o.imageSizes?o.imageSizes:null,l=o.color&&""!==o.color?o.color:"rgba(0,0,0,0)";!o.colorData||""===o.colorData||o.colorData.lightness;var m=e("<img>"),g=e("<canvas>"),u=o.image&&""!==o.image?o.image:null;u?function(e,t){for(var a=e.length;a--;)if(t.indexOf(e[a].url.trim())>-1)return!0;return!1}(c,n)?(s.imageColor=s.imageColor?s.imageColor:defaultImageColor,s.combinedLightness=i(s.imageColor,l),t(a,s.combinedLightness)):(m.attr("src",u.replace(/.*\/(photos|voogstock)/g,"/photos")),m.on("load",(function(){ColorExtract.extract(m[0],g[0],(function(e){s.imageColor=e.bgColor?e.bgColor:"rgba(255,255,255,1)",s.combinedLightness=i(s.imageColor,l),t(a,s.combinedLightness)}))}))):(s.imageColor="rgba(255,255,255,1)",s.combinedLightness=i(s.imageColor,l),t(a,s.combinedLightness)),e(a).find(".js-background-image").first().css({"background-image":d}),e(a).find(".js-background-color").first().css({"background-color":l})},bgPickerCommit:function(t,a,i,o){var s,n=e.extend(!0,{},a);n.image=a.image||"",n.imageSizes=null==(s=a.imageSizes)||"string"==typeof s&&s.match(/^[\\'"]+$/)?"":s,n.color=a.color||"",n.combinedLightness=i.combinedLightness,"articlePage"===o?Edicy.articles.currentArticle.setData(t,n):"productPage"===o?siteData.set(t,n):pageData.set(t,n)},bgPickerColorScheme:function(t){void 0!==t&&(t>.6?e(".header-wrapper").addClass("light").removeClass("dark"):e(".header-wrapper").addClass("dark").removeClass("light"))},bindContentItemImgDropAreas:function(t,a,i){e(".js-content-item-img-drop-area").each((function(s,n){var r=e(n),d=r.closest(".js-content-item-box"),c=d.find(".image_settings-remove"),l=d.data("item-id"),m=d.data("item-type");d.data("image-type"),new Edicy.CustomData({type:m,id:l}),new Edicy.ImgDropArea(r,{positionable:!1,target_width:2048,placeholder:'<div class="edy-img-drop-area-placeholder">'+t+"</div>",removeBtn:null,change:function(t){var s=d.find(".js-toggle-crop-state");r.removeClass("is-cropped").addClass("not-cropped").css("opacity",.1),t?(o(d,s),e(".js-remove-image").css("display","flex")):(d.find(".image_settings").hide(),d.removeClass("with-image is-loaded with-error").addClass("without-image not-loaded"),s.addClass("is-hidden").removeClass("is-visible"),d.find(".edy-img-drop-area-placeholder").css("opacity",0));var n=d.data("item-type"),c=d.data("item-id");new Edicy.CustomData({type:n,id:c}).set({[i]:"not-cropped",[a]:t}),d.removeClass("not-loaded with-error").addClass("is-loaded"),d.find(".edy-img-drop-area-placeholder").css("opacity",1),r.css("opacity",1)}}),c.on("click",(function(){var o=e(this),s=d.data("item-id"),n=d.data("item-type"),r=new Edicy.CustomData({type:n,id:s});r.get({success:function(d){d.item_image?r.remove(a,{success:function(e){r.remove(i,{success:function(e){"article"!==n?handleProductImage(t,s,null,o):addProductImagePlaceholder(o,t)}})}}):e.ajax({type:"PUT",contentType:"application/json",url:"/admin/api/pages/"+s,dataType:"json",data:JSON.stringify({image_id:null})}).then((function(e){addProductImagePlaceholder(o,t)}))}})}))}))},bindContentItemImageCropToggle:function(t){e(".js-toggle-crop-state").on("click",(function(){var a,i=e(this).closest(".js-content-item-box"),o=i.find(".js-content-item-img-drop-area"),s=i.data("item-id"),n=i.data("item-type"),r=new Edicy.CustomData({type:n,id:s});o.hasClass("is-cropped")?(o.removeClass("is-cropped").addClass("not-cropped"),a="not-cropped"):(o.removeClass("not-cropped").addClass("is-cropped"),a="is-cropped"),r.set(t,a)}))}}),window.edy=window.edy||[],edy.push(["texteditorStyles",{name:"Button",tagname:"a",attribute:{href:"#"},classname:"custom-btn",toggle:!0}]),e(".js-data-item").each((function(){e(this).on("change",(function(e){if("checkbox"===e.target.type)var t=e.target.checked;else t=e.target.value;var a=e.target.dataset.name,i=e.target.dataset.id,o=e.target.dataset.entity,s=e.target.dataset.reload;if("site"==o)var n=new Edicy.CustomData({type:"site"});else n=new Edicy.CustomData({type:o,id:i});n.set({[a]:t},{success:function(){s&&location.reload()}})}))})),e(".form_field-cms input").length&&(e(".form_field-cms input").val().length>=1?e(".form_field-cms input").closest(".form_field-cms").addClass("with-input"):e(".form_field-cms input").closest(".form_field-cms").removeClass("with-input")),e(document).ready((function(){e(".form_field-cms input").keyup((function(t){e(this).val().length>=1?e(this).closest(".form_field-cms").addClass("with-input"):e(this).closest(".form_field-cms").removeClass("with-input")}))}))}));
